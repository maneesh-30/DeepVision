<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Settings — NutriComply</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"
        rel="stylesheet" />
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: { "primary": "#12af83", "background-light": "#f6f8f7" },
                    fontFamily: { "display": ["Inter"] },
                    borderRadius: { "DEFAULT": "1rem", "lg": "2rem", "xl": "3rem", "full": "9999px" },
                },
            },
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
    </style>
</head>

<body class="bg-background-light text-slate-900 font-display">
    <div class="relative flex h-auto min-h-screen w-full flex-col overflow-x-hidden">
        <!-- Top Navigation Bar -->
        <header
            class="flex items-center justify-between whitespace-nowrap border-b border-solid border-primary/10 bg-white px-6 py-4 lg:px-20">
            <a href="/" class="flex items-center gap-4 text-primary no-underline">
                <div class="size-8 bg-primary rounded-lg flex items-center justify-center text-white">
                    <span class="material-symbols-outlined">nutrition</span>
                </div>
                <h2 class="text-slate-900 text-xl font-bold leading-tight tracking-[-0.015em]">NutriComply</h2>
            </a>
            <div class="flex flex-1 justify-end gap-4 items-center">
                {% if current_user and current_user.is_authenticated %}
                <a href="/dashboard"
                    class="text-sm font-medium text-slate-500 hover:text-primary transition-colors no-underline hidden sm:block">Dashboard</a>
                <a href="/history"
                    class="text-sm font-medium text-slate-500 hover:text-primary transition-colors no-underline hidden sm:block">History</a>
                <div class="h-10 w-[1px] bg-slate-200 mx-2 hidden sm:block"></div>
                <div class="flex items-center gap-3">
                    <div class="text-right hidden sm:block">
                        <p class="text-sm font-bold text-slate-900 leading-none">{{ current_user.name }}</p>
                        <p class="text-xs text-slate-500">{{ current_user.email }}</p>
                    </div>
                    <div
                        class="size-10 rounded-full bg-primary/20 flex items-center justify-center text-primary font-bold border-2 border-primary/30">
                        {{ current_user.name[:2]|upper }}
                    </div>
                </div>
                {% endif %}
            </div>
        </header>

        <main class="flex flex-1 justify-center py-8 lg:py-12 px-6 lg:px-20">
            <div class="flex flex-col lg:flex-row gap-8 max-w-[1200px] flex-1">
                <!-- Sidebar Navigation -->
                <aside class="flex flex-col gap-2 w-full lg:w-64 flex-shrink-0">
                    <div class="mb-4">
                        <h1 class="text-slate-900 text-lg font-bold">Account Settings</h1>
                        <p class="text-slate-500 text-sm">Manage your account preferences</p>
                    </div>
                    <nav class="flex flex-col gap-1">
                        <a class="flex items-center gap-3 px-4 py-3 rounded bg-primary text-white font-medium transition-all shadow-sm shadow-primary/20 no-underline"
                            href="#profile">
                            <span class="material-symbols-outlined">person</span> Profile
                        </a>
                        <a class="flex items-center gap-3 px-4 py-3 rounded text-slate-600 hover:bg-primary/5 hover:text-primary transition-all no-underline"
                            href="#labels">
                            <span class="material-symbols-outlined">label</span> Label Defaults
                        </a>
                        <a class="flex items-center gap-3 px-4 py-3 rounded text-slate-600 hover:bg-primary/5 hover:text-primary transition-all no-underline"
                            href="#notifications">
                            <span class="material-symbols-outlined">notifications_active</span> Notifications
                        </a>
                    </nav>
                </aside>

                <!-- Main Content Area -->
                <div class="flex-1 flex flex-col gap-10">
                    <!-- Flash Messages -->
                    {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                    {% for category, message in messages %}
                    <div
                        class="px-4 py-3 rounded-xl {% if 'saved' in message.lower() or 'updated' in message.lower() or 'success' in message.lower() %}bg-emerald-50 border border-emerald-200 text-emerald-700{% else %}bg-red-50 border border-red-200 text-red-700{% endif %} text-sm font-semibold">
                        {{ message }}
                    </div>
                    {% endfor %}
                    {% endif %}
                    {% endwith %}

                    <!-- Profile Section -->
                    <section class="bg-white p-6 lg:p-8 rounded-xl border border-slate-200 shadow-sm" id="profile">
                        <h3 class="text-xl font-bold mb-6 text-slate-900">Personal Information</h3>

                        <!-- Display Name -->
                        <form method="POST" action="/settings/update-name" class="mb-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <label class="flex flex-col gap-2">
                                    <span class="text-sm font-semibold text-slate-700">Display Name</span>
                                    <input
                                        class="form-input rounded-lg border-slate-300 focus:ring-primary focus:border-primary text-slate-900 h-12"
                                        type="text" name="name" value="{{ current_user.name }}" required />
                                </label>
                            </div>
                            <div class="mt-4 flex justify-end">
                                <button
                                    class="bg-primary hover:bg-primary/90 text-white font-bold py-2.5 px-6 rounded transition-colors"
                                    type="submit">Save Name</button>
                            </div>
                        </form>

                        <hr class="border-slate-100 my-6">

                        <!-- Email Change -->
                        <form method="POST" action="/settings/update-email" class="mb-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <label class="flex flex-col gap-2">
                                    <span class="text-sm font-semibold text-slate-700">Email Address</span>
                                    <input
                                        class="form-input rounded-lg border-slate-300 focus:ring-primary focus:border-primary text-slate-900 h-12"
                                        type="email" name="email" value="{{ current_user.email }}" required />
                                </label>
                                <label class="flex flex-col gap-2">
                                    <span class="text-sm font-semibold text-slate-700">Confirm Password <span
                                            class="text-slate-400 font-normal">(required to change email)</span></span>
                                    <input
                                        class="form-input rounded-lg border-slate-300 focus:ring-primary focus:border-primary text-slate-900 h-12"
                                        type="password" name="password" placeholder="Enter your current password"
                                        required />
                                </label>
                            </div>
                            <div class="mt-4 flex justify-end">
                                <button
                                    class="bg-primary hover:bg-primary/90 text-white font-bold py-2.5 px-6 rounded transition-colors"
                                    type="submit">Update Email</button>
                            </div>
                        </form>

                        <hr class="border-slate-100 my-6">

                        <!-- Change Password -->
                        <form method="POST" action="/settings/change-password">
                            <h4 class="text-base font-bold text-slate-900 mb-4">Change Password</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <label class="flex flex-col gap-2 md:col-span-2">
                                    <span class="text-sm font-semibold text-slate-700">Current Password</span>
                                    <input
                                        class="form-input rounded-lg border-slate-300 focus:ring-primary focus:border-primary text-slate-900 h-12"
                                        type="password" name="current_password" placeholder="••••••••" required />
                                </label>
                                <label class="flex flex-col gap-2">
                                    <span class="text-sm font-semibold text-slate-700">New Password</span>
                                    <input
                                        class="form-input rounded-lg border-slate-300 focus:ring-primary focus:border-primary text-slate-900 h-12"
                                        type="password" name="new_password" placeholder="Min 6 characters" required />
                                </label>
                                <label class="flex flex-col gap-2">
                                    <span class="text-sm font-semibold text-slate-700">Confirm New Password</span>
                                    <input
                                        class="form-input rounded-lg border-slate-300 focus:ring-primary focus:border-primary text-slate-900 h-12"
                                        type="password" name="confirm_password" placeholder="Re-enter new password"
                                        required />
                                </label>
                            </div>
                            <div class="mt-6 flex justify-end">
                                <button
                                    class="bg-primary hover:bg-primary/90 text-white font-bold py-2.5 px-6 rounded transition-colors"
                                    type="submit">Change Password</button>
                            </div>
                        </form>
                    </section>

                    <!-- Label Defaults Section -->
                    <section class="bg-white p-6 lg:p-8 rounded-xl border border-slate-200 shadow-sm" id="labels">
                        <h3 class="text-xl font-bold mb-2 text-slate-900">Label Defaults</h3>
                        <p class="text-sm text-slate-500 mb-6">These values will be pre-filled for every new nutritional
                            label you create.</p>
                        <form method="POST" action="/settings/save-defaults">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <label class="flex flex-col gap-2">
                                    <span class="text-sm font-semibold text-slate-700">Default FSSAI License No.</span>
                                    <input
                                        class="form-input rounded-lg border-slate-300 focus:ring-primary focus:border-primary text-slate-900 h-12"
                                        type="text" name="default_license" value="{{ settings.default_license or '' }}"
                                        placeholder="100XXXXXXXXXXX" />
                                </label>
                                <label class="flex flex-col gap-2">
                                    <span class="text-sm font-semibold text-slate-700">Standard Serving Size
                                        (g/ml)</span>
                                    <input
                                        class="form-input rounded-lg border-slate-300 focus:ring-primary focus:border-primary text-slate-900 h-12"
                                        type="number" name="default_serving_size"
                                        value="{{ settings.default_serving_size if settings.default_serving_size else '' }}"
                                        step="0.1" placeholder="100" />
                                </label>
                                <label class="flex flex-col gap-2 md:col-span-2">
                                    <span class="text-sm font-semibold text-slate-700">Company Name</span>
                                    <input
                                        class="form-input rounded-lg border-slate-300 focus:ring-primary focus:border-primary text-slate-900 h-12"
                                        type="text" name="default_company_name"
                                        value="{{ settings.default_company_name or '' }}"
                                        placeholder="NutriFoods Pvt Ltd" />
                                </label>
                                <label class="flex flex-col gap-2 md:col-span-2">
                                    <span class="text-sm font-semibold text-slate-700">Registered Office Address</span>
                                    <textarea
                                        class="form-textarea rounded-lg border-slate-300 focus:ring-primary focus:border-primary text-slate-900"
                                        name="default_address" rows="3"
                                        placeholder="Suite 405, Business Tower, Industry Area...">{{ settings.default_address or '' }}</textarea>
                                </label>
                            </div>
                            <div class="mt-6 flex justify-end">
                                <button
                                    class="bg-primary hover:bg-primary/90 text-white font-bold py-2.5 px-6 rounded transition-colors"
                                    type="submit">Update Defaults</button>
                            </div>
                        </form>
                    </section>

                    <!-- Notifications Section -->
                    <section class="bg-white p-6 lg:p-8 rounded-xl border border-slate-200 shadow-sm"
                        id="notifications">
                        <h3 class="text-xl font-bold mb-6 text-slate-900">Notification Preferences</h3>
                        <form method="POST" action="/settings/save-notifications">
                            <div class="space-y-6">
                                <div class="flex items-center justify-between">
                                    <div class="flex flex-col">
                                        <p class="font-semibold text-slate-900">Email Confirmations</p>
                                        <p class="text-sm text-slate-500">Receive an email whenever a label is finalized
                                            or exported.</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input class="sr-only peer" type="checkbox" name="email_notifications" value="1"
                                            {% if settings.email_notifications %}checked{% endif %} />
                                        <div
                                            class="w-11 h-6 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary">
                                        </div>
                                    </label>
                                </div>
                                <div class="flex items-center justify-between border-t border-slate-100 pt-6">
                                    <div class="flex flex-col">
                                        <p class="font-semibold text-slate-900">Compliance Alerts</p>
                                        <p class="text-sm text-slate-500">Get notified when compliance score drops below
                                            80%.</p>
                                    </div>
                                    <label class="relative inline-flex items-center cursor-pointer">
                                        <input class="sr-only peer" type="checkbox" name="score_alert" value="1" {% if
                                            settings.score_alert %}checked{% endif %} />
                                        <div
                                            class="w-11 h-6 bg-slate-200 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary">
                                        </div>
                                    </label>
                                </div>
                            </div>
                            <div class="mt-8 flex justify-end">
                                <button
                                    class="bg-primary hover:bg-primary/90 text-white font-bold py-2.5 px-6 rounded transition-colors"
                                    type="submit">Save Notifications</button>
                            </div>
                        </form>
                    </section>
                </div>
            </div>
        </main>

        <footer class="mt-auto py-8 px-6 lg:px-20 border-t border-slate-200 text-center">
            <p class="text-slate-500 text-sm">© 2026 NutriComply Inc. All rights reserved. Ensuring global nutritional
                standards.</p>
        </footer>
    </div>
</body>

</html>